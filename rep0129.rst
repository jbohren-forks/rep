REP: 130
Title: Separation of environment and source tree tools
Author: Tully Foote <tfoote@willowgarage.com>, Dirk Thomas <dthomas@willowgarage.com>, Thibault Kruse <kruset@in.tum.de>, William Woodall <wwoodall@willowgarage.com>
Status: Active
Type: Informational
Content-Type: text/x-rst
Created: 09-Nov-2012
Post-History:


Abstract
========

This REP defines the redesign of the rosinstall/rosws [1]_ tools for
catkin [2]_ workspaces, into two new commands, called wstool and
catkin_make.

Specification
=============

For catkin workspaces in ROS groovy, the rosws command will be
replaced by a similar command that mirrors rosws syntax and
functionality the same except for the management of the workspace
environment, which included the generation of setup.*sh files and
workspace specific information in the rosinstall file.

There will be a new command as part of the catkin ecosystem called
catkin_make, this one creates a folder structure as given in REP128.

wstool commands and options will be those of rosws:
wstool init: same as rosws init, but wstool has no --catkin and no --cmake-prefix-path option, also does not generate setup files.

The following commands retain their options and semantics from rosws:
wstool update
wstool diff
wstool status
wstool info
wstool set
wstool merge

there is no equivalent command for rosws regenerate.

The catkin_make command has this syntax:
catkin_make init [PATH]: create a REP128 compatible folder structure in PATH or current folder.
This also involves creating environment setup file setup.*sh as specified in REP128.

Motivation
==========

Early ROS releases shipped with the ``rosinstall`` tool, which
provided communication with severeal SCMs, maintenance of a folder
tree, creation of a build and runtime environment (via the ROS_PACKAGE_PATH).

With the migration to catkin, the functionality of rosws to search for
a ROS stack and generate a setup.sh file that sets ROS environment variables
is not required anymore, but instead is confusing.

As a workaround, a special option for rosinstall and rosws has been added
to rosinstall / rosws with the release of ROS fuerte:

rosinstall --catkin ...
rosws init --catkin ...
rosws regenerate --catkin ...

The --catkin option suppresses generation of setup.*sh files, and
instead generates a CMakeLists.txt.

With this option the user always has to remember to call the --catkin
option, else setup.*sh files would be generated, which could be confusing.
While there is no harm, users can be expected to be confused.

Therefore, differently named commands will be used for each kind of workspace,
providing a clearer separation of concerns with the tools.

The new tools can also later be extended to better support
the different contraints of catkin workspaces without compromising the simplicity
and robustness which currnetly exist in rosws/rosinstall.

Also this problem reveals the general problem of mixing source
management with setting up an environment. While rosinstall allowed
setting up a workspace with just a single command, this design made
it hard for rosinstall to support several ROS distributions with ever
changing environment properties.

Therefore, the rosws replacement for catkin workspaces will not offer
any environment generation capabilities (setup.sh and similar), but merely
maintain a single declarative file with source projects and the file tree.

Environment tools may use the file syntax or library functions to reason
about the source tree and generate an environment accordingly.

Rationale
=========

REP128 drafts a model workspace for usage with catkin.

This is the recommended layout for development::

 workspace_folder/        --WORKSPACE
   src/                   --SOURCE SPACE
     CMakeLists.txt       --This is symlinked to catkin/cmake/toplevel.cmake
   build/                 --BUILD SPACE
     CATKIN_IGNORE        --Marking the folder to be ignored when crawling for packages
   devel/                 --DEVEL SPACE
     .catkin              --Marking the folder as a development space (the file contains a semicolon separated list of Source space paths)
     env.bash
     setup.bash
     setup.sh
     setup.zsh

Setting up this workspace manually is tedious and error-prone. The
catkin_make tool will create this structure, possibly by invoking
other tools such as cmake. The implementation details of catkin_make
are not part of this REP.

wstool will act only on the src folder::

 workspace_folder/        --WORKSPACE
   src/                   --SOURCE SPACE
     CMakeLists.txt       --This is symlinked to catkin/cmake/toplevel.cmake
     .rosinstall

wstool init will create a .rosinstall file which will act the same way
as for the rosinstall tool before.

The wstool commands will affect this .rosinstall file and subfolders of the src folder.


Alternatives
------------

- Keep --catkin option

Not desirable because of user confusion

- change rosws default behavior

Not desirable because of documentation backwards compatibility

- Automatic detection of workspace type

Not possible without fragile hacks

Backwards Compatibility
=======================

The rosws command remains functionally identical and will continue to be maintained.

Reference Implementation
========================

The Groovy distribution of ROS will provide two separate tools
following the guidelines of this REP.


References and Footnotes
========================

.. [1] rosinstall
  (http://www.ros.org/wiki/rosinstall)

.. [2] catkin
  (http://www.ros.org/wiki/catkin)

Copyright
=========

This document has been placed in the public domain.


..
   Local Variables:
   mode: indented-text
   indent-tabs-mode: nil
   sentence-end-double-space: t
   fill-column: 70
   coding: utf-8
   End:

